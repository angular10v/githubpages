(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{qTjg:function(t,c,e){"use strict";e.r(c),e.d(c,"AppChatsModule",(function(){return tt}));var a=e("ofXK"),n=e("tyNb"),i=e("3Pt+"),s=e("bTqV"),o=e("Wp6s"),r=e("NFeN"),h=e("qFsG"),l=e("MutI"),u=e("STbY"),d=e("XhcP"),g=e("/t3+"),m=e("YUcS"),b=e("2Vo4"),p=e("XNiG"),v=e("itXk"),f=e("LRne"),C=e("eIep"),S=e("lJxs");e("HDdC").a.prototype.switchMap=function(t){return Object(C.a)(t)(this)};var M=e("fXoL"),y=e("tk/3");class I{}let w=(()=>{class t{constructor(t){this.http=t,this.onContactSelected=new b.a(null),this.onUserUpdated=new p.a,this.onChatSelected=new b.a(null),this.onChatsUpdated=new p.a}loadChatData(){return Object(v.a)(this.getAllContacts(),this.getAllChats(),this.getCurrentUser(),(t,c,e)=>{this.contacts=t,this.chats=c,this.user=e,this.onUserUpdated.next(e)})}getChatByContact(t){let c=this.user.chatInfo.find(c=>c.contactId===t);return this.collectionLoading=!0,c?this.getAllChats().switchMap(e=>{let a=e.find(t=>t.id===c.chatId),n=this.contacts.find(c=>c.id===t);return this.onChatSelected.next({chatCollection:a,contact:n}),this.collectionLoading=!1,Object(f.a)(a)}):this.createChatCollection(t).switchMap(c=>this.getChatByContact(t))}createChatCollection(t){let c=this.contacts.find(c=>c.id===t);const e=(1e9*Math.random()).toString(),a={id:e,chats:[]};let n={chatId:e,lastChatTime:new Date,contactId:c.id,contactName:c.name,contactMessage:c.message,unread:null};return this.http.post("api/chat-collections",Object.assign({},a)).switchMap(t=>(this.user.chatInfo.push(n),this.updateUser(this.user).pipe(Object(C.a)(t=>this.getCurrentUser().pipe(Object(S.a)(t=>{this.user=t,this.onUserUpdated.next(t)}))))))}getAllContacts(){return this.http.get("api/contacts")}getAllChats(){return this.http.get("api/chat-collections")}getCurrentUser(){return this.http.get("api/chat-user").pipe(Object(S.a)(t=>t[0]))}updateUser(t){return this.http.put("api/chat-user/"+t.id,Object.assign({},t))}updateChats(t,c){return this.http.put("api/chat-collections",{id:t,chats:c})}autoReply(t){setTimeout(()=>{this.onChatsUpdated.next(t)},1500)}}return t.\u0275fac=function(c){return new(c||t)(M.lc(y.c))},t.\u0275prov=M.Xb({token:t,factory:t.\u0275fac}),t})();var A=e("pD6V"),x=e("bFKe"),U=e("znSr"),F=e("FKr1");const O=function(t){return{online:t}};function k(t,c){if(1&t){const t=M.ic();M.hc(0,"mat-list-item",8),M.pc("click",(function(){M.Tc(t);const e=c.$implicit;return M.tc().getChatByContact(e.id)})),M.hc(1,"a",9),M.cc(2,"img",2),M.cc(3,"span",3),M.gc(),M.hc(4,"h4",10),M.cd(5),M.gc(),M.hc(6,"p",11),M.cd(7),M.gc(),M.hc(8,"div",12),M.hc(9,"small",13),M.cd(10),M.gc(),M.gc(),M.gc()}if(2&t){const t=c.$implicit;M.Mb(1),M.Ac("ngClass",M.Gc(5,O,"online"===t.status)),M.Mb(1),M.Ac("src",t.avatar,M.Vc),M.Mb(3),M.dd(t.name),M.Mb(2),M.dd(t.message),M.Mb(3),M.dd(t.time)}}let L=(()=>{class t{constructor(t,c){this.chatService=t,this.cdr=c,this.isSidenavOpen=!0,this.currentUser=new I}ngOnInit(){this.userUpdateSub=this.chatService.onUserUpdated.subscribe(t=>{this.currentUser=t}),this.loadDataSub=this.chatService.loadChatData().subscribe(t=>{this.currentUser=this.chatService.user,this.contacts=this.chatService.contacts,this.cdr.markForCheck()})}ngOnDestroy(){this.userUpdateSub&&this.userUpdateSub.unsubscribe(),this.loadDataSub&&this.loadDataSub.unsubscribe()}getChatByContact(t){this.chatService.getChatByContact(t).subscribe(t=>{},t=>{console.log(t)})}}return t.\u0275fac=function(c){return new(c||t)(M.bc(w),M.bc(M.i))},t.\u0275cmp=M.Vb({type:t,selectors:[["app-chat-left-sidenav"]],decls:9,vars:3,consts:[[1,"chat-sidebar-toolbar","p-16"],["href","",1,"toolbar-avatar","online"],["alt","",3,"src"],[1,"status-dot"],[1,"m-0","pl-1","font-normal","fz-1"],[1,"chat-sidebar-scroll",3,"perfectScrollbar"],["role","list",1,"inbox-nav-list"],["class","border-bottom",3,"click",4,"ngFor","ngForOf"],[1,"border-bottom",3,"click"],["mat-list-avatar","",1,"toolbar-avatar",3,"ngClass"],["matLine","",1,"fw-500"],["matLine","",1,"mr-1","text-muted"],[1,"talk-time"],[1,"text-muted"]],template:function(t,c){1&t&&(M.hc(0,"mat-toolbar",0),M.hc(1,"a",1),M.cc(2,"img",2),M.cc(3,"span",3),M.gc(),M.hc(4,"h6",4),M.cd(5),M.gc(),M.gc(),M.hc(6,"div",5),M.hc(7,"mat-nav-list",6),M.ad(8,k,11,7,"mat-list-item",7),M.gc(),M.gc()),2&t&&(M.Mb(2),M.Ac("src",c.currentUser.avatar,M.Vc),M.Mb(3),M.dd(c.currentUser.name),M.Mb(3),M.Ac("ngForOf",c.contacts))},directives:[g.a,x.b,l.g,a.p,l.d,l.b,a.o,U.a,F.k],styles:[""]}),t})();var T=e("XiUz"),D=e("f0Cb"),j=e("kmnG"),q=e("336X");const B=["msgForm"],V=["msgInput"],G=function(t){return{online:t}};function N(t,c){if(1&t&&(M.hc(0,"div",10),M.hc(1,"a",11),M.cc(2,"img",12),M.cc(3,"span",13),M.gc(),M.hc(4,"div",14),M.hc(5,"h6",15),M.cd(6),M.gc(),M.gc(),M.gc()),2&t){const t=M.tc();M.Mb(1),M.Ac("ngClass",M.Gc(3,G,"online"===t.activeContact.status)),M.Mb(1),M.Ac("src",t.activeContact.avatar,M.Vc),M.Mb(4),M.dd(t.activeContact.name)}}function X(t,c){if(1&t&&(M.hc(0,"a",30),M.cc(1,"img",31),M.cc(2,"span",13),M.gc()),2&t){const t=M.tc(3);M.Ac("ngClass",M.Gc(3,G,"online"===t.user.status)),M.Mb(1),M.Ac("src",null==t.user?null:t.user.avatar,M.Vc)("alt",null==t.user?null:t.user.name)}}function z(t,c){if(1&t&&(M.hc(0,"a",30),M.cc(1,"img",31),M.cc(2,"span",13),M.gc()),2&t){const t=M.tc(3);M.Ac("ngClass",M.Gc(3,G,"online"===t.activeContact.status)),M.Mb(1),M.Ac("src",null==t.activeContact?null:t.activeContact.avatar,M.Vc)("alt",null==t.activeContact?null:t.activeContact.name)}}function H(t,c){if(1&t&&(M.hc(0,"h5",32),M.cd(1),M.gc()),2&t){const t=M.tc(3);M.Mb(1),M.dd(null==t.activeContact?null:t.activeContact.name)}}function $(t,c){if(1&t&&(M.hc(0,"h5",32),M.cd(1),M.gc()),2&t){const t=M.tc(3);M.Mb(1),M.dd(null==t.user?null:t.user.name)}}const R=function(t,c){return{sender:t,me:c}};function W(t,c){if(1&t&&(M.hc(0,"div",25),M.ad(1,X,3,5,"a",26),M.ad(2,z,3,5,"a",26),M.hc(3,"div"),M.ad(4,H,2,1,"h5",27),M.ad(5,$,2,1,"h5",27),M.hc(6,"div",28),M.cd(7),M.gc(),M.hc(8,"p",29),M.cd(9),M.uc(10,"relativeTime"),M.gc(),M.gc(),M.gc()),2&t){const t=c.$implicit,e=M.tc(2);M.Ac("ngClass",M.Hc(9,R,t.contactId===e.activeContact.id,t.contactId!==e.activeContact.id)),M.Mb(1),M.Ac("ngIf",t.contactId!==e.activeContact.id),M.Mb(1),M.Ac("ngIf",t.contactId===e.activeContact.id),M.Mb(2),M.Ac("ngIf",t.contactId===e.activeContact.id),M.Mb(1),M.Ac("ngIf",t.contactId!==e.activeContact.id),M.Mb(2),M.ed(" ",t.text," "),M.Mb(2),M.dd(M.vc(10,7,t.time))}}function Y(t,c){if(1&t){const t=M.ic();M.hc(0,"div"),M.hc(1,"div",16),M.ad(2,W,11,12,"div",17),M.gc(),M.cc(3,"mat-divider"),M.hc(4,"div",18),M.hc(5,"form",19,20),M.pc("ngSubmit",(function(c){return M.Tc(t),M.tc().sendMessage(c)}))("keydown.enter",(function(c){return M.Tc(t),M.tc().sendMessage(c)})),M.hc(7,"mat-form-field",21),M.cc(8,"textarea",22,23),M.gc(),M.hc(10,"button",24),M.hc(11,"mat-icon"),M.cd(12,"send"),M.gc(),M.gc(),M.gc(),M.gc(),M.gc()}if(2&t){const t=M.tc();M.Mb(2),M.Ac("ngForOf",null==t.chatCollection?null:t.chatCollection.chats)}}function _(t,c){1&t&&(M.hc(0,"div",33),M.hc(1,"div",34),M.hc(2,"div",35),M.cc(3,"div",36),M.cc(4,"div",37),M.gc(),M.gc(),M.gc())}const J=function(){return{height:"160px",width:"160px",borderRadius:"50%"}},K=function(){return{height:"45px",width:"45px"}};function P(t,c){1&t&&(M.hc(0,"div",38),M.hc(1,"mat-card",39),M.cc(2,"mat-icon",40),M.gc(),M.hc(3,"h1",41),M.cd(4,"Start a conversation"),M.gc(),M.gc()),2&t&&(M.Mb(1),M.Ac("ngStyle",M.Fc(2,J)),M.Mb(1),M.Ac("ngStyle",M.Fc(3,K)))}let Z=(()=>{class t{constructor(t,c){this.chatService=t,this.cdr=c,this.user=new I,this.activeContact=new I}ngOnInit(){this.userUpdateSub=this.chatService.onUserUpdated.subscribe(t=>{this.user=t,this.cdr.markForCheck()}),this.chatSelectSub=this.chatService.onChatSelected.subscribe(t=>{t&&(this.chatCollection=t.chatCollection,this.activeContact=t.contact,this.initMsgForm(),this.cdr.markForCheck())}),this.chatUpdateSub=this.chatService.onChatsUpdated.subscribe(t=>{this.chatCollection.chats.push(t),this.scrollToBottom(),this.cdr.markForCheck()})}ngOnDestroy(){this.userUpdateSub&&this.userUpdateSub.unsubscribe(),this.chatSelectSub&&this.chatSelectSub.unsubscribe(),this.chatUpdateSub&&this.chatUpdateSub.unsubscribe()}sendMessage(t){if(!this.msgForm.form.value.message||!this.msgForm.form.value.message.trim().length)return;const c={contactId:this.chatService.user.id,text:this.msgForm.form.value.message,time:(new Date).toISOString()};this.chatCollection.chats.push(c),this.chatService.updateChats(this.chatCollection.id,[...this.chatCollection.chats]).subscribe(t=>{this.initMsgForm(),this.cdr.markForCheck()}),this.chatService.autoReply({contactId:this.activeContact.id,text:`Hi, I'm ${this.activeContact.name}. How are you?`,time:(new Date).toISOString()})}initMsgForm(){setTimeout(()=>{this.msgForm&&this.msgForm.reset(),this.msgInput&&this.msgInput.first&&this.msgInput.first.nativeElement.focus(),this.scrollToBottom()})}scrollToBottom(){setTimeout(()=>{this.psContainer&&this.psContainer.update(),this.psContainer&&this.psContainer.scrollToBottom(0,400)})}}return t.\u0275fac=function(c){return new(c||t)(M.bc(w),M.bc(M.i))},t.\u0275cmp=M.Vb({type:t,selectors:[["app-chat-contents"]],viewQuery:function(t,c){var e;1&t&&(M.hd(x.b,!0),M.hd(B,!0),M.hd(V,!0)),2&t&&(M.Oc(e=M.qc())&&(c.psContainer=e.first),M.Oc(e=M.qc())&&(c.msgForm=e.first),M.Oc(e=M.qc())&&(c.msgInput=e))},inputs:{matSidenav:"matSidenav"},decls:26,vars:9,consts:[[1,"chat-toolbar","p-16"],["mat-icon-button","",1,"mr-1",3,"click"],["class","active-chat-user","fxLayout","row","fxLayoutAlign","start center",4,"ngIf"],["fxFlex",""],["mat-icon-button","",1,"topbar-button-right","hidden-on-open",3,"matMenuTriggerFor"],["toolbarDDMenu","matMenu"],["mat-menu-item",""],[4,"ngIf"],["class","chat-intro",4,"ngIf"],["class","chat-intro","fxLayout","column","fxLayoutAlign","center center",4,"ngIf"],["fxLayout","row","fxLayoutAlign","start center",1,"active-chat-user"],[1,"toolbar-avatar","mr-1",3,"ngClass"],["alt","",3,"src"],[1,"status-dot"],["fxLayout","column"],[1,"m-0","font-normal","fz-1"],[1,"conversations-hold",3,"perfectScrollbar"],["class","single-conversation","fxLayout","row",3,"ngClass",4,"ngFor","ngForOf"],[1,"chat-input-actions"],["fxLayout","row",1,"inputForm",3,"ngSubmit","keydown.enter"],["msgForm","ngForm"],[1,"full-width","mr-1"],["matInput","","required","","ngModel","","placeholder","Type a message","name","message","value","",1,"inputText"],["msgInput",""],["mat-fab","","color","primary","type","submit"],["fxLayout","row",1,"single-conversation",3,"ngClass"],["href","","class","toolbar-avatar",3,"ngClass",4,"ngIf"],["class","chat-username text-muted",4,"ngIf"],[1,"conversation-msg"],[1,"chat-date","text-muted"],["href","",1,"toolbar-avatar",3,"ngClass"],[3,"src","alt"],[1,"chat-username","text-muted"],[1,"chat-intro"],[1,"chat-loader"],[1,"spinner"],[1,"double-bounce1","mat-bg-accent"],[1,"double-bounce2","mat-bg-primary"],["fxLayout","column","fxLayoutAlign","center center",1,"chat-intro"],["fxLayout","row","fxLayoutAlign","center center",1,"text-center",3,"ngStyle"],["svgIcon","chat","color","primary",1,"text-60","btn-icon",3,"ngStyle"],[1,"fw-700"]],template:function(t,c){if(1&t&&(M.hc(0,"mat-toolbar",0),M.hc(1,"button",1),M.pc("click",(function(){return c.matSidenav.toggle()})),M.hc(2,"mat-icon"),M.cd(3,"short_text"),M.gc(),M.gc(),M.ad(4,N,7,5,"div",2),M.cc(5,"span",3),M.hc(6,"button",4),M.hc(7,"mat-icon"),M.cd(8,"more_vert"),M.gc(),M.gc(),M.hc(9,"mat-menu",null,5),M.hc(11,"button",6),M.hc(12,"mat-icon"),M.cd(13,"account_circle"),M.gc(),M.cd(14,"Contact info"),M.gc(),M.hc(15,"button",6),M.hc(16,"mat-icon"),M.cd(17,"volume_mute"),M.gc(),M.cd(18,"Mute"),M.gc(),M.hc(19,"button",6),M.hc(20,"mat-icon"),M.cd(21,"delete"),M.gc(),M.cd(22,"Clear chat"),M.gc(),M.gc(),M.gc(),M.ad(23,Y,13,1,"div",7),M.ad(24,_,5,0,"div",8),M.ad(25,P,5,4,"div",9)),2&t){const t=M.Pc(10);M.Mb(1),M.Zc("align-self","center"),M.Mb(3),M.Ac("ngIf",c.activeContact.id),M.Mb(2),M.Zc("align-self","center"),M.Ac("matMenuTriggerFor",t),M.Mb(17),M.Ac("ngIf",c.chatCollection&&!c.chatService.collectionLoading),M.Mb(1),M.Ac("ngIf",c.chatService.collectionLoading),M.Mb(1),M.Ac("ngIf",!c.chatCollection&&!c.chatService.collectionLoading)}},directives:[g.a,s.b,r.a,a.q,T.b,u.c,u.d,u.a,T.d,T.c,a.o,U.a,x.b,a.p,D.a,i.A,i.q,i.r,j.c,h.b,i.c,i.w,i.p,i.s,o.a,a.r,U.c],pipes:[q.a],styles:[""]}),t})();const Q=[{path:"",component:(()=>{class t{constructor(t,c){this.mediaObserver=t,this.chatService=c,this.isSidenavOpen=!0,this.activeChatUser={name:"Gevorg Spartak",photo:"assets/images/face-2.jpg",isOnline:!0,lastMsg:"Hello!"},this.user=c.user}ngOnInit(){this.chatSideBarInit()}ngOnDestroy(){this.screenSizeWatcher&&this.screenSizeWatcher.unsubscribe()}changeActiveUser(t){this.activeChatUser=t}updateSidenav(){var t=this;setTimeout(()=>{t.isSidenavOpen=!t.isMobile,t.sideNav.mode=t.isMobile?"over":"side"})}chatSideBarInit(){this.isMobile=this.mediaObserver.isActive("xs")||this.mediaObserver.isActive("sm"),this.updateSidenav(),this.screenSizeWatcher=this.mediaObserver.media$.subscribe(t=>{this.isMobile="xs"===t.mqAlias||"sm"===t.mqAlias,this.updateSidenav()})}}return t.\u0275fac=function(c){return new(c||t)(M.bc(A.g),M.bc(w))},t.\u0275cmp=M.Vb({type:t,selectors:[["app-chats"]],viewQuery:function(t,c){var e;1&t&&M.hd(d.d,!0),2&t&&M.Oc(e=M.qc())&&(c.sideNav=e.first)},decls:6,vars:2,consts:[[1,"p-0","border-shadow-0"],[1,"chat-container"],["mode","side",1,"chat-sidenav",3,"opened"],[1,"chats-wrap"],[3,"matSidenav"]],template:function(t,c){1&t&&(M.hc(0,"mat-card",0),M.hc(1,"mat-sidenav-container",1),M.hc(2,"mat-sidenav",2),M.cc(3,"app-chat-left-sidenav"),M.gc(),M.hc(4,"div",3),M.cc(5,"app-chat-contents",4),M.gc(),M.gc(),M.gc()),2&t&&(M.Mb(2),M.Ac("opened",c.isSidenavOpen),M.Mb(3),M.Ac("matSidenav",c.sideNav))},directives:[o.a,d.e,d.d,L,Z],styles:[""],changeDetection:0}),t})(),data:{title:"Chat"}}];var E=e("aYsj");let tt=(()=>{class t{}return t.\u0275mod=M.Zb({type:t}),t.\u0275inj=M.Yb({factory:function(c){return new(c||t)},providers:[w],imports:[[a.c,i.l,d.g,u.b,h.c,r.b,s.c,l.e,g.b,o.g,m.a,x.c,E.a,n.k.forChild(Q)]]}),t})()}}]);