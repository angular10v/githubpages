function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var c=Object.prototype.toString.call(t).slice(8,-1);return"Object"===c&&t.constructor&&(c=t.constructor.name),"Map"===c||"Set"===c?Array.from(t):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var c=0,a=new Array(e);c<e;c++)a[c]=t[c];return a}function _defineProperties(t,e){for(var c=0;c<e.length;c++){var a=e[c];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,c){return e&&_defineProperties(t.prototype,e),c&&_defineProperties(t,c),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{qTjg:function(t,e,c){"use strict";c.r(e),c.d(e,"AppChatsModule",(function(){return it}));var a=c("ofXK"),n=c("tyNb"),i=c("3Pt+"),r=c("bTqV"),o=c("Wp6s"),s=c("NFeN"),u=c("qFsG"),l=c("MutI"),h=c("STbY"),d=c("XhcP"),f=c("/t3+"),g=c("YUcS"),v=c("2Vo4"),m=c("XNiG"),b=c("itXk"),p=c("LRne"),C=c("eIep"),y=c("lJxs");c("HDdC").a.prototype.switchMap=function(t){return Object(C.a)(t)(this)};var S,k=c("fXoL"),A=c("tk/3"),M=function t(){_classCallCheck(this,t)},I=((S=function(){function t(e){_classCallCheck(this,t),this.http=e,this.onContactSelected=new v.a(null),this.onUserUpdated=new m.a,this.onChatSelected=new v.a(null),this.onChatsUpdated=new m.a}return _createClass(t,[{key:"loadChatData",value:function(){var t=this;return Object(b.a)(this.getAllContacts(),this.getAllChats(),this.getCurrentUser(),(function(e,c,a){t.contacts=e,t.chats=c,t.user=a,t.onUserUpdated.next(a)}))}},{key:"getChatByContact",value:function(t){var e=this,c=this.user.chatInfo.find((function(e){return e.contactId===t}));return this.collectionLoading=!0,c?this.getAllChats().switchMap((function(a){var n=a.find((function(t){return t.id===c.chatId})),i=e.contacts.find((function(e){return e.id===t}));return e.onChatSelected.next({chatCollection:n,contact:i}),e.collectionLoading=!1,Object(p.a)(n)})):this.createChatCollection(t).switchMap((function(c){return e.getChatByContact(t)}))}},{key:"createChatCollection",value:function(t){var e=this,c=this.contacts.find((function(e){return e.id===t})),a=(1e9*Math.random()).toString(),n={id:a,chats:[]},i={chatId:a,lastChatTime:new Date,contactId:c.id,contactName:c.name,contactMessage:c.message,unread:null};return this.http.post("api/chat-collections",Object.assign({},n)).switchMap((function(t){return e.user.chatInfo.push(i),e.updateUser(e.user).pipe(Object(C.a)((function(t){return e.getCurrentUser().pipe(Object(y.a)((function(t){e.user=t,e.onUserUpdated.next(t)})))})))}))}},{key:"getAllContacts",value:function(){return this.http.get("api/contacts")}},{key:"getAllChats",value:function(){return this.http.get("api/chat-collections")}},{key:"getCurrentUser",value:function(){return this.http.get("api/chat-user").pipe(Object(y.a)((function(t){return t[0]})))}},{key:"updateUser",value:function(t){return this.http.put("api/chat-user/"+t.id,Object.assign({},t))}},{key:"updateChats",value:function(t,e){return this.http.put("api/chat-collections",{id:t,chats:e})}},{key:"autoReply",value:function(t){var e=this;setTimeout((function(){e.onChatsUpdated.next(t)}),1500)}}]),t}()).\u0275fac=function(t){return new(t||S)(k.lc(A.c))},S.\u0275prov=k.Xb({token:S,factory:S.\u0275fac}),S),w=c("pD6V"),x=c("bFKe"),U=c("znSr"),O=c("FKr1"),F=function(t){return{online:t}};function _(t,e){if(1&t){var c=k.ic();k.hc(0,"mat-list-item",8),k.pc("click",(function(){k.Tc(c);var t=e.$implicit;return k.tc().getChatByContact(t.id)})),k.hc(1,"a",9),k.cc(2,"img",2),k.cc(3,"span",3),k.gc(),k.hc(4,"h4",10),k.cd(5),k.gc(),k.hc(6,"p",11),k.cd(7),k.gc(),k.hc(8,"div",12),k.hc(9,"small",13),k.cd(10),k.gc(),k.gc(),k.gc()}if(2&t){var a=e.$implicit;k.Mb(1),k.Ac("ngClass",k.Gc(5,F,"online"===a.status)),k.Mb(1),k.Ac("src",a.avatar,k.Vc),k.Mb(3),k.dd(a.name),k.Mb(2),k.dd(a.message),k.Mb(3),k.dd(a.time)}}var T,L=((T=function(){function t(e,c){_classCallCheck(this,t),this.chatService=e,this.cdr=c,this.isSidenavOpen=!0,this.currentUser=new M}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.userUpdateSub=this.chatService.onUserUpdated.subscribe((function(e){t.currentUser=e})),this.loadDataSub=this.chatService.loadChatData().subscribe((function(e){t.currentUser=t.chatService.user,t.contacts=t.chatService.contacts,t.cdr.markForCheck()}))}},{key:"ngOnDestroy",value:function(){this.userUpdateSub&&this.userUpdateSub.unsubscribe(),this.loadDataSub&&this.loadDataSub.unsubscribe()}},{key:"getChatByContact",value:function(t){this.chatService.getChatByContact(t).subscribe((function(t){}),(function(t){console.log(t)}))}}]),t}()).\u0275fac=function(t){return new(t||T)(k.bc(I),k.bc(k.i))},T.\u0275cmp=k.Vb({type:T,selectors:[["app-chat-left-sidenav"]],decls:9,vars:3,consts:[[1,"chat-sidebar-toolbar","p-16"],["href","",1,"toolbar-avatar","online"],["alt","",3,"src"],[1,"status-dot"],[1,"m-0","pl-1","font-normal","fz-1"],[1,"chat-sidebar-scroll",3,"perfectScrollbar"],["role","list",1,"inbox-nav-list"],["class","border-bottom",3,"click",4,"ngFor","ngForOf"],[1,"border-bottom",3,"click"],["mat-list-avatar","",1,"toolbar-avatar",3,"ngClass"],["matLine","",1,"fw-500"],["matLine","",1,"mr-1","text-muted"],[1,"talk-time"],[1,"text-muted"]],template:function(t,e){1&t&&(k.hc(0,"mat-toolbar",0),k.hc(1,"a",1),k.cc(2,"img",2),k.cc(3,"span",3),k.gc(),k.hc(4,"h6",4),k.cd(5),k.gc(),k.gc(),k.hc(6,"div",5),k.hc(7,"mat-nav-list",6),k.ad(8,_,11,7,"mat-list-item",7),k.gc(),k.gc()),2&t&&(k.Mb(2),k.Ac("src",e.currentUser.avatar,k.Vc),k.Mb(3),k.dd(e.currentUser.name),k.Mb(3),k.Ac("ngForOf",e.contacts))},directives:[f.a,x.b,l.g,a.p,l.d,l.b,a.o,U.a,O.k],styles:[""]}),T),j=c("XiUz"),D=c("f0Cb"),q=c("kmnG"),B=c("336X"),V=["msgForm"],G=["msgInput"],N=function(t){return{online:t}};function X(t,e){if(1&t&&(k.hc(0,"div",10),k.hc(1,"a",11),k.cc(2,"img",12),k.cc(3,"span",13),k.gc(),k.hc(4,"div",14),k.hc(5,"h6",15),k.cd(6),k.gc(),k.gc(),k.gc()),2&t){var c=k.tc();k.Mb(1),k.Ac("ngClass",k.Gc(3,N,"online"===c.activeContact.status)),k.Mb(1),k.Ac("src",c.activeContact.avatar,k.Vc),k.Mb(4),k.dd(c.activeContact.name)}}function z(t,e){if(1&t&&(k.hc(0,"a",30),k.cc(1,"img",31),k.cc(2,"span",13),k.gc()),2&t){var c=k.tc(3);k.Ac("ngClass",k.Gc(3,N,"online"===c.user.status)),k.Mb(1),k.Ac("src",null==c.user?null:c.user.avatar,k.Vc)("alt",null==c.user?null:c.user.name)}}function H(t,e){if(1&t&&(k.hc(0,"a",30),k.cc(1,"img",31),k.cc(2,"span",13),k.gc()),2&t){var c=k.tc(3);k.Ac("ngClass",k.Gc(3,N,"online"===c.activeContact.status)),k.Mb(1),k.Ac("src",null==c.activeContact?null:c.activeContact.avatar,k.Vc)("alt",null==c.activeContact?null:c.activeContact.name)}}function P(t,e){if(1&t&&(k.hc(0,"h5",32),k.cd(1),k.gc()),2&t){var c=k.tc(3);k.Mb(1),k.dd(null==c.activeContact?null:c.activeContact.name)}}function W(t,e){if(1&t&&(k.hc(0,"h5",32),k.cd(1),k.gc()),2&t){var c=k.tc(3);k.Mb(1),k.dd(null==c.user?null:c.user.name)}}var $=function(t,e){return{sender:t,me:e}};function R(t,e){if(1&t&&(k.hc(0,"div",25),k.ad(1,z,3,5,"a",26),k.ad(2,H,3,5,"a",26),k.hc(3,"div"),k.ad(4,P,2,1,"h5",27),k.ad(5,W,2,1,"h5",27),k.hc(6,"div",28),k.cd(7),k.gc(),k.hc(8,"p",29),k.cd(9),k.uc(10,"relativeTime"),k.gc(),k.gc(),k.gc()),2&t){var c=e.$implicit,a=k.tc(2);k.Ac("ngClass",k.Hc(9,$,c.contactId===a.activeContact.id,c.contactId!==a.activeContact.id)),k.Mb(1),k.Ac("ngIf",c.contactId!==a.activeContact.id),k.Mb(1),k.Ac("ngIf",c.contactId===a.activeContact.id),k.Mb(2),k.Ac("ngIf",c.contactId===a.activeContact.id),k.Mb(1),k.Ac("ngIf",c.contactId!==a.activeContact.id),k.Mb(2),k.ed(" ",c.text," "),k.Mb(2),k.dd(k.vc(10,7,c.time))}}function Y(t,e){if(1&t){var c=k.ic();k.hc(0,"div"),k.hc(1,"div",16),k.ad(2,R,11,12,"div",17),k.gc(),k.cc(3,"mat-divider"),k.hc(4,"div",18),k.hc(5,"form",19,20),k.pc("ngSubmit",(function(t){return k.Tc(c),k.tc().sendMessage(t)}))("keydown.enter",(function(t){return k.Tc(c),k.tc().sendMessage(t)})),k.hc(7,"mat-form-field",21),k.cc(8,"textarea",22,23),k.gc(),k.hc(10,"button",24),k.hc(11,"mat-icon"),k.cd(12,"send"),k.gc(),k.gc(),k.gc(),k.gc(),k.gc()}if(2&t){var a=k.tc();k.Mb(2),k.Ac("ngForOf",null==a.chatCollection?null:a.chatCollection.chats)}}function E(t,e){1&t&&(k.hc(0,"div",33),k.hc(1,"div",34),k.hc(2,"div",35),k.cc(3,"div",36),k.cc(4,"div",37),k.gc(),k.gc(),k.gc())}var J=function(){return{height:"160px",width:"160px",borderRadius:"50%"}},K=function(){return{height:"45px",width:"45px"}};function Z(t,e){1&t&&(k.hc(0,"div",38),k.hc(1,"mat-card",39),k.cc(2,"mat-icon",40),k.gc(),k.hc(3,"h1",41),k.cd(4,"Start a conversation"),k.gc(),k.gc()),2&t&&(k.Mb(1),k.Ac("ngStyle",k.Fc(2,J)),k.Mb(1),k.Ac("ngStyle",k.Fc(3,K)))}var Q,tt,et,ct=((Q=function(){function t(e,c){_classCallCheck(this,t),this.chatService=e,this.cdr=c,this.user=new M,this.activeContact=new M}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.userUpdateSub=this.chatService.onUserUpdated.subscribe((function(e){t.user=e,t.cdr.markForCheck()})),this.chatSelectSub=this.chatService.onChatSelected.subscribe((function(e){e&&(t.chatCollection=e.chatCollection,t.activeContact=e.contact,t.initMsgForm(),t.cdr.markForCheck())})),this.chatUpdateSub=this.chatService.onChatsUpdated.subscribe((function(e){t.chatCollection.chats.push(e),t.scrollToBottom(),t.cdr.markForCheck()}))}},{key:"ngOnDestroy",value:function(){this.userUpdateSub&&this.userUpdateSub.unsubscribe(),this.chatSelectSub&&this.chatSelectSub.unsubscribe(),this.chatUpdateSub&&this.chatUpdateSub.unsubscribe()}},{key:"sendMessage",value:function(t){var e=this;if(this.msgForm.form.value.message&&this.msgForm.form.value.message.trim().length){var c={contactId:this.chatService.user.id,text:this.msgForm.form.value.message,time:(new Date).toISOString()};this.chatCollection.chats.push(c),this.chatService.updateChats(this.chatCollection.id,_toConsumableArray(this.chatCollection.chats)).subscribe((function(t){e.initMsgForm(),e.cdr.markForCheck()})),this.chatService.autoReply({contactId:this.activeContact.id,text:"Hi, I'm ".concat(this.activeContact.name,". How are you?"),time:(new Date).toISOString()})}}},{key:"initMsgForm",value:function(){var t=this;setTimeout((function(){t.msgForm&&t.msgForm.reset(),t.msgInput&&t.msgInput.first&&t.msgInput.first.nativeElement.focus(),t.scrollToBottom()}))}},{key:"scrollToBottom",value:function(){var t=this;setTimeout((function(){t.psContainer&&t.psContainer.update(),t.psContainer&&t.psContainer.scrollToBottom(0,400)}))}}]),t}()).\u0275fac=function(t){return new(t||Q)(k.bc(I),k.bc(k.i))},Q.\u0275cmp=k.Vb({type:Q,selectors:[["app-chat-contents"]],viewQuery:function(t,e){var c;1&t&&(k.hd(x.b,!0),k.hd(V,!0),k.hd(G,!0)),2&t&&(k.Oc(c=k.qc())&&(e.psContainer=c.first),k.Oc(c=k.qc())&&(e.msgForm=c.first),k.Oc(c=k.qc())&&(e.msgInput=c))},inputs:{matSidenav:"matSidenav"},decls:26,vars:9,consts:[[1,"chat-toolbar","p-16"],["mat-icon-button","",1,"mr-1",3,"click"],["class","active-chat-user","fxLayout","row","fxLayoutAlign","start center",4,"ngIf"],["fxFlex",""],["mat-icon-button","",1,"topbar-button-right","hidden-on-open",3,"matMenuTriggerFor"],["toolbarDDMenu","matMenu"],["mat-menu-item",""],[4,"ngIf"],["class","chat-intro",4,"ngIf"],["class","chat-intro","fxLayout","column","fxLayoutAlign","center center",4,"ngIf"],["fxLayout","row","fxLayoutAlign","start center",1,"active-chat-user"],[1,"toolbar-avatar","mr-1",3,"ngClass"],["alt","",3,"src"],[1,"status-dot"],["fxLayout","column"],[1,"m-0","font-normal","fz-1"],[1,"conversations-hold",3,"perfectScrollbar"],["class","single-conversation","fxLayout","row",3,"ngClass",4,"ngFor","ngForOf"],[1,"chat-input-actions"],["fxLayout","row",1,"inputForm",3,"ngSubmit","keydown.enter"],["msgForm","ngForm"],[1,"full-width","mr-1"],["matInput","","required","","ngModel","","placeholder","Type a message","name","message","value","",1,"inputText"],["msgInput",""],["mat-fab","","color","primary","type","submit"],["fxLayout","row",1,"single-conversation",3,"ngClass"],["href","","class","toolbar-avatar",3,"ngClass",4,"ngIf"],["class","chat-username text-muted",4,"ngIf"],[1,"conversation-msg"],[1,"chat-date","text-muted"],["href","",1,"toolbar-avatar",3,"ngClass"],[3,"src","alt"],[1,"chat-username","text-muted"],[1,"chat-intro"],[1,"chat-loader"],[1,"spinner"],[1,"double-bounce1","mat-bg-accent"],[1,"double-bounce2","mat-bg-primary"],["fxLayout","column","fxLayoutAlign","center center",1,"chat-intro"],["fxLayout","row","fxLayoutAlign","center center",1,"text-center",3,"ngStyle"],["svgIcon","chat","color","primary",1,"text-60","btn-icon",3,"ngStyle"],[1,"fw-700"]],template:function(t,e){if(1&t&&(k.hc(0,"mat-toolbar",0),k.hc(1,"button",1),k.pc("click",(function(){return e.matSidenav.toggle()})),k.hc(2,"mat-icon"),k.cd(3,"short_text"),k.gc(),k.gc(),k.ad(4,X,7,5,"div",2),k.cc(5,"span",3),k.hc(6,"button",4),k.hc(7,"mat-icon"),k.cd(8,"more_vert"),k.gc(),k.gc(),k.hc(9,"mat-menu",null,5),k.hc(11,"button",6),k.hc(12,"mat-icon"),k.cd(13,"account_circle"),k.gc(),k.cd(14,"Contact info"),k.gc(),k.hc(15,"button",6),k.hc(16,"mat-icon"),k.cd(17,"volume_mute"),k.gc(),k.cd(18,"Mute"),k.gc(),k.hc(19,"button",6),k.hc(20,"mat-icon"),k.cd(21,"delete"),k.gc(),k.cd(22,"Clear chat"),k.gc(),k.gc(),k.gc(),k.ad(23,Y,13,1,"div",7),k.ad(24,E,5,0,"div",8),k.ad(25,Z,5,4,"div",9)),2&t){var c=k.Pc(10);k.Mb(1),k.Zc("align-self","center"),k.Mb(3),k.Ac("ngIf",e.activeContact.id),k.Mb(2),k.Zc("align-self","center"),k.Ac("matMenuTriggerFor",c),k.Mb(17),k.Ac("ngIf",e.chatCollection&&!e.chatService.collectionLoading),k.Mb(1),k.Ac("ngIf",e.chatService.collectionLoading),k.Mb(1),k.Ac("ngIf",!e.chatCollection&&!e.chatService.collectionLoading)}},directives:[f.a,r.b,s.a,a.q,j.b,h.c,h.d,h.a,j.d,j.c,a.o,U.a,x.b,a.p,D.a,i.A,i.q,i.r,q.c,u.b,i.c,i.w,i.p,i.s,o.a,a.r,U.c],pipes:[B.a],styles:[""]}),Q),at=[{path:"",component:(tt=function(){function t(e,c){_classCallCheck(this,t),this.mediaObserver=e,this.chatService=c,this.isSidenavOpen=!0,this.activeChatUser={name:"Gevorg Spartak",photo:"assets/images/face-2.jpg",isOnline:!0,lastMsg:"Hello!"},this.user=c.user}return _createClass(t,[{key:"ngOnInit",value:function(){this.chatSideBarInit()}},{key:"ngOnDestroy",value:function(){this.screenSizeWatcher&&this.screenSizeWatcher.unsubscribe()}},{key:"changeActiveUser",value:function(t){this.activeChatUser=t}},{key:"updateSidenav",value:function(){var t=this;setTimeout((function(){t.isSidenavOpen=!t.isMobile,t.sideNav.mode=t.isMobile?"over":"side"}))}},{key:"chatSideBarInit",value:function(){var t=this;this.isMobile=this.mediaObserver.isActive("xs")||this.mediaObserver.isActive("sm"),this.updateSidenav(),this.screenSizeWatcher=this.mediaObserver.media$.subscribe((function(e){t.isMobile="xs"===e.mqAlias||"sm"===e.mqAlias,t.updateSidenav()}))}}]),t}(),tt.\u0275fac=function(t){return new(t||tt)(k.bc(w.g),k.bc(I))},tt.\u0275cmp=k.Vb({type:tt,selectors:[["app-chats"]],viewQuery:function(t,e){var c;1&t&&k.hd(d.d,!0),2&t&&k.Oc(c=k.qc())&&(e.sideNav=c.first)},decls:6,vars:2,consts:[[1,"p-0","border-shadow-0"],[1,"chat-container"],["mode","side",1,"chat-sidenav",3,"opened"],[1,"chats-wrap"],[3,"matSidenav"]],template:function(t,e){1&t&&(k.hc(0,"mat-card",0),k.hc(1,"mat-sidenav-container",1),k.hc(2,"mat-sidenav",2),k.cc(3,"app-chat-left-sidenav"),k.gc(),k.hc(4,"div",3),k.cc(5,"app-chat-contents",4),k.gc(),k.gc(),k.gc()),2&t&&(k.Mb(2),k.Ac("opened",e.isSidenavOpen),k.Mb(3),k.Ac("matSidenav",e.sideNav))},directives:[o.a,d.e,d.d,L,ct],styles:[""],changeDetection:0}),tt),data:{title:"Chat"}}],nt=c("aYsj"),it=((et=function t(){_classCallCheck(this,t)}).\u0275mod=k.Zb({type:et}),et.\u0275inj=k.Yb({factory:function(t){return new(t||et)},providers:[I],imports:[[a.c,i.l,d.g,h.b,u.c,s.b,r.c,l.e,f.b,o.g,g.a,x.c,nt.a,n.k.forChild(at)]]}),et)}}]);